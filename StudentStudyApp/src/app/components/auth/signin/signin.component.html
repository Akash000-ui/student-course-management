<div class="auth-container">
  <div class="auth-wrapper">
    <div class="auth-card">
      <!-- Sign In Step -->
      <div *ngIf="!showOtpStep">
        <div class="auth-header">
          <div class="auth-icon-wrapper">
            <mat-icon class="auth-icon">login</mat-icon>
          </div>
          <h1 class="auth-title">Welcome Back</h1>
          <p class="auth-subtitle">Sign in to your StudyHub account</p>
        </div>

        <form [formGroup]="signinForm" (ngSubmit)="onSubmit()" class="auth-form">
          <!-- Email Field -->
          <div class="form-group">
            <label for="email" class="form-label">
              <mat-icon>email</mat-icon>
              Email Address
            </label>
            <input id="email" type="email" formControlName="email" placeholder="Enter your email" class="form-input"
              autocomplete="email">
            <div class="form-errors"
              *ngIf="signinForm.get('email')?.hasError('required') && signinForm.get('email')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Email is required
            </div>
            <div class="form-errors"
              *ngIf="signinForm.get('email')?.hasError('email') && signinForm.get('email')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Please enter a valid email address
            </div>
          </div>

          <!-- Password Field -->
          <div class="form-group">
            <label for="password" class="form-label">
              <mat-icon>lock</mat-icon>
              Password
            </label>
            <div class="password-input-wrapper">
              <input id="password" [type]="hidePassword ? 'password' : 'text'" formControlName="password"
                placeholder="Enter your password" class="form-input" autocomplete="current-password">
              <button type="button" class="password-toggle" (click)="hidePassword = !hidePassword">
                <mat-icon>{{hidePassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
            </div>
            <div class="form-errors"
              *ngIf="signinForm.get('password')?.hasError('required') && signinForm.get('password')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Password is required
            </div>
          </div>

          <!-- Remember Me -->
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="rememberMe" class="checkbox">
              <span class="checkmark"></span>
              Remember me
            </label>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="submit-btn" [disabled]="signinForm.invalid || loading" [class.loading]="loading">
            <mat-icon *ngIf="!loading">login</mat-icon>
            <mat-icon *ngIf="loading" class="spinner">refresh</mat-icon>
            <span>{{loading ? 'Signing In...' : 'Sign In'}}</span>
          </button>

          <!-- Error Message -->
          <div class="error-message" *ngIf="errorMessage">
            <mat-icon>error</mat-icon>
            {{errorMessage}}
          </div>
        </form>

        <div class="divider"><span>Or</span></div>
        <div id="googleSignInBtn" style="display:flex; justify-content:center; margin: 10px 0 0 0;"></div>

        <div class="auth-footer">
          <p>Don't have an account?
            <a routerLink="/signup" class="auth-link">Sign up here</a>
          </p>
          <a routerLink="/forgot-password" class="forgot-password">Forgot password?</a>
        </div>
      </div>

      <!-- OTP Verification Step -->
      <div *ngIf="showOtpStep">
        <div class="auth-header">
          <div class="auth-icon-wrapper">
            <mat-icon class="auth-icon">mail_outline</mat-icon>
          </div>
          <h1 class="auth-title">Verify Your Email</h1>
          <p class="auth-subtitle">
            We've sent a 6-digit OTP to<br>
            <strong>{{signinForm.value.email}}</strong>
          </p>
        </div>

        <form [formGroup]="otpForm" (ngSubmit)="onVerifyOtp()" class="auth-form">
          <!-- OTP Input -->
          <div class="form-group">
            <label for="otp" class="form-label">
              <mat-icon>dialpad</mat-icon>
              Enter OTP
            </label>
            <input id="otp" type="text" formControlName="otp" placeholder="Enter 6-digit OTP"
              class="form-input otp-input" maxlength="6" autocomplete="one-time-code">
            <div class="form-errors" *ngIf="otpForm.get('otp')?.hasError('required') && otpForm.get('otp')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              OTP is required
            </div>
            <div class="form-errors" *ngIf="otpForm.get('otp')?.hasError('pattern') && otpForm.get('otp')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              OTP must be 6 digits
            </div>
          </div>

          <!-- Verify Button -->
          <button type="submit" class="submit-btn" [disabled]="otpForm.invalid || loading" [class.loading]="loading">
            <mat-icon *ngIf="!loading">verified</mat-icon>
            <mat-icon *ngIf="loading" class="spinner">refresh</mat-icon>
            <span>{{loading ? 'Verifying...' : 'Verify & Sign In'}}</span>
          </button>

          <!-- Error Message -->
          <div class="error-message" *ngIf="errorMessage">
            <mat-icon>error</mat-icon>
            {{errorMessage}}
          </div>
        </form>

        <!-- Resend OTP -->
        <div class="otp-actions">
          <button type="button" class="text-btn" (click)="onResendOtp()" [disabled]="resendDisabled">
            <mat-icon>refresh</mat-icon>
            <span *ngIf="!resendDisabled">Resend OTP</span>
            <span *ngIf="resendDisabled">Resend in {{resendCountdown}}s</span>
          </button>
          <button type="button" class="text-btn" (click)="goBackToSignin()">
            <mat-icon>arrow_back</mat-icon>
            Back to Sign In
          </button>
        </div>
      </div>
    </div>
  </div>
</div>