<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Header -->
    <div class="header">
      <button class="back-button" (click)="navigateToSignIn()">
        <span class="material-icons">arrow_back</span>
      </button>
      <h1>Reset Password</h1>
      <p class="subtitle">{{ currentStep === 'email' ? 'Enter your email to receive OTP' :
        currentStep === 'otp' ? 'Enter the OTP sent to your email' :
        'Create your new password' }}</p>
    </div>

    <!-- Step Indicator -->
    <div class="step-indicator">
      <div class="step" [class.active]="currentStep === 'email'" [class.completed]="currentStep !== 'email'">
        <div class="step-circle">1</div>
        <span>Email</span>
      </div>
      <div class="step-line" [class.completed]="currentStep !== 'email'"></div>
      <div class="step" [class.active]="currentStep === 'otp'" [class.completed]="currentStep === 'reset'">
        <div class="step-circle">2</div>
        <span>Verify OTP</span>
      </div>
      <div class="step-line" [class.completed]="currentStep === 'reset'"></div>
      <div class="step" [class.active]="currentStep === 'reset'">
        <div class="step-circle">3</div>
        <span>New Password</span>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="error-message">
      <span class="material-icons">error</span>
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="success-message">
      <span class="material-icons">check_circle</span>
      {{ successMessage }}
    </div>

    <!-- Step 1: Email Form -->
    <form *ngIf="currentStep === 'email'" [formGroup]="emailForm" (ngSubmit)="onSubmitEmail()" class="form">
      <div class="form-group">
        <label for="email">Email Address</label>
        <div class="input-wrapper">
          <span class="material-icons">email</span>
          <input type="email" id="email" formControlName="email" placeholder="Enter your email"
            [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched" />
        </div>
        <div *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched" class="field-error">
          <span *ngIf="emailForm.get('email')?.errors?.['required']">Email is required</span>
          <span *ngIf="emailForm.get('email')?.errors?.['email']">Please enter a valid email</span>
        </div>
      </div>

      <button type="submit" class="submit-button" [disabled]="loading || emailForm.invalid">
        <span *ngIf="!loading">Send OTP</span>
        <span *ngIf="loading" class="spinner"></span>
      </button>
    </form>

    <!-- Step 2: OTP Form -->
    <form *ngIf="currentStep === 'otp'" [formGroup]="otpForm" (ngSubmit)="onSubmitOtp()" class="form">
      <div class="form-group">
        <label for="otp">Enter OTP</label>
        <div class="input-wrapper">
          <span class="material-icons">pin</span>
          <input type="text" id="otp" formControlName="otp" placeholder="Enter 6-digit OTP" maxlength="6"
            [class.error]="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched" />
        </div>
        <div *ngIf="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched" class="field-error">
          <span *ngIf="otpForm.get('otp')?.errors?.['required']">OTP is required</span>
          <span *ngIf="otpForm.get('otp')?.errors?.['minlength'] || otpForm.get('otp')?.errors?.['maxlength']">
            OTP must be 6 digits
          </span>
        </div>
        <p class="otp-info">OTP sent to: <strong>{{ email }}</strong></p>
      </div>

      <button type="submit" class="submit-button" [disabled]="loading || otpForm.invalid">
        <span *ngIf="!loading">Verify OTP</span>
        <span *ngIf="loading" class="spinner"></span>
      </button>
    </form>

    <!-- Step 3: Reset Password Form -->
    <form *ngIf="currentStep === 'reset'" [formGroup]="resetForm" class="form">
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <div class="input-wrapper">
          <span class="material-icons">lock</span>
          <input [type]="showPassword ? 'text' : 'password'" id="newPassword" formControlName="newPassword"
            placeholder="Enter new password"
            [class.error]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched" />
          <button type="button" class="toggle-password" (click)="togglePasswordVisibility('password')">
            <span class="material-icons">{{ showPassword ? 'visibility_off' : 'visibility' }}</span>
          </button>
        </div>
        <div *ngIf="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched" class="field-error">
          <span *ngIf="resetForm.get('newPassword')?.errors?.['required']">Password is required</span>
          <span *ngIf="resetForm.get('newPassword')?.errors?.['minlength']">
            Password must be at least 6 characters
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <div class="input-wrapper">
          <span class="material-icons">lock_outline</span>
          <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword"
            formControlName="confirmPassword" placeholder="Confirm new password"
            [class.error]="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched" />
          <button type="button" class="toggle-password" (click)="togglePasswordVisibility('confirm')">
            <span class="material-icons">{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</span>
          </button>
        </div>
        <div *ngIf="resetForm.get('confirmPassword')?.touched" class="field-error">
          <span *ngIf="resetForm.get('confirmPassword')?.errors?.['required']">Please confirm password</span>
          <span *ngIf="resetForm.errors?.['mismatch'] && !resetForm.get('confirmPassword')?.errors?.['required']">
            Passwords do not match
          </span>
        </div>
      </div>

      <div class="button-group">
        <button type="button" class="submit-button primary" (click)="onSubmitReset()"
          [disabled]="loading || resetForm.invalid">
          <span *ngIf="!loading">Reset Password & Sign In</span>
          <span *ngIf="loading" class="spinner"></span>
        </button>
      </div>
    </form>

    <!-- Back to Sign In Link -->
    <div class="footer">
      <p>Remember your password? <a routerLink="/signin">Sign In</a></p>
    </div>
  </div>
</div>