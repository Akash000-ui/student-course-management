<!-- Sign Up Page -->
<div class="auth-container">
  <div class="auth-wrapper">
    <div class="auth-card">
      <!-- Registration Step -->
      <div *ngIf="!showOtpStep">
        <div class="auth-header">
          <div class="auth-icon-wrapper">
            <mat-icon class="auth-icon">person_add</mat-icon>
          </div>
          <h1 class="auth-title">Join StudyHub</h1>
          <p class="auth-subtitle">Create your account to start learning</p>
        </div>

        <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="auth-form">
          <!-- Username Field -->
          <div class="form-group">
            <label for="username" class="form-label">
              <mat-icon>person</mat-icon>
              Username
            </label>
            <input id="username" type="text" formControlName="username" placeholder="Choose a username"
              class="form-input" autocomplete="username">
            <div class="form-errors"
              *ngIf="signupForm.get('username')?.hasError('required') && signupForm.get('username')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Username is required
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('username')?.hasError('minlength') && signupForm.get('username')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Username must be at least 3 characters long
            </div>
          </div>

          <!-- Email Field -->
          <div class="form-group">
            <label for="email" class="form-label">
              <mat-icon>email</mat-icon>
              Email Address
            </label>
            <input id="email" type="email" formControlName="email" placeholder="Enter your email" class="form-input"
              autocomplete="email">
            <div class="form-errors"
              *ngIf="signupForm.get('email')?.hasError('required') && signupForm.get('email')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Email is required
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('email')?.hasError('email') && signupForm.get('email')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Please enter a valid email address
            </div>
          </div>

          <!-- Mobile Number Field -->
          <div class="form-group">
            <label for="mobileNumber" class="form-label">
              <mat-icon>phone</mat-icon>
              Mobile Number
            </label>
            <input id="mobileNumber" type="tel" formControlName="mobileNumber"
              placeholder="Enter your 10-digit mobile number" class="form-input" autocomplete="tel" maxlength="10">
            <div class="form-errors"
              *ngIf="signupForm.get('mobileNumber')?.hasError('required') && signupForm.get('mobileNumber')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Mobile number is required
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('mobileNumber')?.hasError('pattern') && signupForm.get('mobileNumber')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Please enter a valid 10-digit Indian mobile number
            </div>
          </div>

          <!-- Password Field -->
          <div class="form-group">
            <label for="password" class="form-label">
              <mat-icon>lock</mat-icon>
              Password
            </label>
            <div class="password-input-wrapper">
              <input id="password" [type]="hidePassword ? 'password' : 'text'" formControlName="password"
                placeholder="Create a password" class="form-input" autocomplete="new-password">
              <button type="button" class="password-toggle" (click)="hidePassword = !hidePassword">
                <mat-icon>{{hidePassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('password')?.hasError('required') && signupForm.get('password')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Password is required
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('password')?.hasError('minlength') && signupForm.get('password')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Password must be at least 6 characters long
            </div>
          </div>

          <!-- Confirm Password Field -->
          <div class="form-group">
            <label for="confirmPassword" class="form-label">
              <mat-icon>lock_outline</mat-icon>
              Confirm Password
            </label>
            <div class="password-input-wrapper">
              <input id="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword" placeholder="Confirm your password" class="form-input"
                autocomplete="new-password">
              <button type="button" class="password-toggle" (click)="hideConfirmPassword = !hideConfirmPassword">
                <mat-icon>{{hideConfirmPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
            </div>
            <div class="form-errors"
              *ngIf="signupForm.get('confirmPassword')?.hasError('required') && signupForm.get('confirmPassword')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Please confirm your password
            </div>
            <div class="form-errors"
              *ngIf="signupForm.hasError('passwordMismatch') && signupForm.get('confirmPassword')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              Passwords do not match
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="agreeToTerms" class="checkbox">
              <span class="checkmark"></span>
              I agree to the <a href="#" class="terms-link">Terms and Conditions</a>
            </label>
            <div class="form-errors"
              *ngIf="signupForm.get('agreeToTerms')?.hasError('required') && signupForm.get('agreeToTerms')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              You must agree to the terms and conditions
            </div>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="submit-btn" [disabled]="signupForm.invalid || loading" [class.loading]="loading">
            <mat-icon *ngIf="!loading">send</mat-icon>
            <mat-icon *ngIf="loading" class="spinner">refresh</mat-icon>
            <span>{{loading ? 'Sending OTP...' : 'Send OTP'}}</span>
          </button>

          <!-- Error Message -->
          <div class="error-message" *ngIf="errorMessage">
            <mat-icon>error</mat-icon>
            {{errorMessage}}
          </div>
        </form>

        <div class="divider"><span>Or</span></div>
        <div id="googleSignUpBtn" style="display:flex; justify-content:center; margin: 10px 0 0 0;"></div>

        <div class="auth-footer">
          <p>Already have an account?
            <a routerLink="/signin" class="auth-link">Sign in here</a>
          </p>
        </div>
      </div>

      <!-- OTP Verification Step -->
      <div *ngIf="showOtpStep">
        <div class="auth-header">
          <div class="auth-icon-wrapper">
            <mat-icon class="auth-icon">mail_outline</mat-icon>
          </div>
          <h1 class="auth-title">Verify Your Email</h1>
          <p class="auth-subtitle">
            We've sent a 6-digit OTP to<br>
            <strong>{{signupForm.value.email}}</strong>
          </p>
        </div>

        <form [formGroup]="otpForm" (ngSubmit)="onVerifyOtp()" class="auth-form">
          <!-- OTP Input -->
          <div class="form-group">
            <label for="otp" class="form-label">
              <mat-icon>dialpad</mat-icon>
              Enter OTP
            </label>
            <input id="otp" type="text" formControlName="otp" placeholder="Enter 6-digit OTP"
              class="form-input otp-input" maxlength="6" autocomplete="one-time-code">
            <div class="form-errors" *ngIf="otpForm.get('otp')?.hasError('required') && otpForm.get('otp')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              OTP is required
            </div>
            <div class="form-errors" *ngIf="otpForm.get('otp')?.hasError('pattern') && otpForm.get('otp')?.touched">
              <mat-icon class="error-icon">error</mat-icon>
              OTP must be 6 digits
            </div>
          </div>

          <!-- Verify Button -->
          <button type="submit" class="submit-btn" [disabled]="otpForm.invalid || loading" [class.loading]="loading">
            <mat-icon *ngIf="!loading">verified</mat-icon>
            <mat-icon *ngIf="loading" class="spinner">refresh</mat-icon>
            <span>{{loading ? 'Verifying...' : 'Verify & Create Account'}}</span>
          </button>

          <!-- Error Message -->
          <div class="error-message" *ngIf="errorMessage">
            <mat-icon>error</mat-icon>
            {{errorMessage}}
          </div>
        </form>

        <!-- Resend OTP -->
        <div class="otp-actions">
          <button type="button" class="text-btn" (click)="onResendOtp()" [disabled]="resendDisabled">
            <mat-icon>refresh</mat-icon>
            <span *ngIf="!resendDisabled">Resend OTP</span>
            <span *ngIf="resendDisabled">Resend in {{resendCountdown}}s</span>
          </button>
          <button type="button" class="text-btn" (click)="goBackToSignup()">
            <mat-icon>arrow_back</mat-icon>
            Back to Sign Up
          </button>
        </div>
      </div>
    </div>
  </div>
</div>